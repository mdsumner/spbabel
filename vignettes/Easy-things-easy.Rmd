---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The Spatial classes in the `sp` package are very high-level data structures to store traditional GIS layers of points, lines and polygons. This document aims to list tasks that should be easy to do on these data sets, but that for various reasons are quite complicated or hard to understand. 

Using the `spbabel` package we show how these tasks can be done in a straightforward way. 

# Example data

We will use two data sets, one completely abstract and trivial and the other complicated and related to the real-world. 



## Summary of the underlying geometry
```{r}
p1 <- data_frame(x_ = c(0, 0, 0.75, 1,   0.5, 0.8, 0.69, 0), 
            y_ = c(0, 1, 1,    0.8, 0.7, 0.6, 0,    0)) %>% 
  mutate(object_ = 1, island_ = TRUE, branch_ = 1, order_ = row_number())
p2 <- data_frame(x_ = c(0.2, 0.2, 0.3, 0.5, 0.5, 0.2), 
            y_ = c(0.2, 0.4, 0.6, 0.4, 0.2, 0.2)) %>% 
  mutate(object_ = 1, island_ = FALSE, branch_ = 2, order_ = row_number())
p3 <- data_frame(x_ = c(0.25, 0.3, 0.4, 0.4, 0.25),
                 y_ = c(0.25, 0.5, 0.48, 0.25, 0.25)) %>% 
  mutate(object_ = 1, island_ = TRUE, branch_ = 3, order_ = row_number())
p4 <- data_frame(x_ = c(0.30, 0.31, 0.37, 0.30),
                 y_ = c(0.4, 0.36, 0.36, 0.4)) %>% 
  mutate(object_ = 1, island_ = FALSE, branch_ = 4, order_ = row_number())

pp <- bind_rows(p1, p2, p3, p4)  # .id = "branch_")
plot(spFromTable(pp), col = "grey")

pp$object_ <- 1; pp$





library(maptools)
data(wrld_simpl)
library(sptable)
st <- sptable(wrld_simpl)

## how many islands, holes, and vertices?
## cordinates
st %>% nrow()
## vertices
st %>% distinct(x_, y_) %>% nrow()
## of 3697 islands, each has no fewer than 4 coordinates, and a maximum of 678
st %>% filter(island_) %>% group_by(branch_) %>% tally() %>% summarize(min =min(n), max = max(n), n = n())
## but the 71 holes are much less interesting
st %>% filter(!island_) %>% group_by(branch_) %>% tally() %>% summarize(min =min(n), max = max(n), n = n())

nrow(st)


holylands <-  inner_join(wrld_simpl %>% mutate(object_ = row_number()), 
                             st %>% distinct(branch_) %>% filter(!island_) %>% distinct(object_) %>% dplyr::select(object_)
                           )

library(rgdal)
midproj <- function(xy) sprintf("+proj=laea +lon_0=%f +lat_0=%f +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0", 
                                xy[1], xy[2])
midpoint <- function(x) unlist(sptable(x) %>% summarize(mean(x_), mean(y_)))
pdf("data-raw/holy.pdf")
for (i in seq(nrow(holyislands))) {
  h0 <- holyislands[i, ]
  plot(spTransform(h0, midproj(midpoint(h0))), col = "black", main = h0$NAME)
}
dev.off()


## no multi-part objects, just holes
```