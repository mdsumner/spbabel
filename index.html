<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convert Spatial Data Using Tidy Tables • spbabel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Convert Spatial Data Using Tidy Tables">
<meta property="og:description" content="Tools to convert from specific formats to more general forms of 
    spatial data. Using tables to store the actual entities present in spatial
    data provides flexibility, and the functions here deliberately 
    minimize the level of interpretation applied, leaving that for specific 
    applications. Includes support for simple features,  round-trip for Spatial classes and long-form 
    tables, analogous to ggplot2::fortify. There is also a more normal form representation
    that decomposes simple features and their kin to tables of objects, parts, and unique coordinates. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">spbabel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mdsumner/spbabel/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><strong>Historical NOTE:</strong> <em>spbabel is a product of its time, when the sp package was de rigeur in R spatial and we needed external workarounds to get around the limitations imposed by sp. Now we have to work around the inflexibility and lack of modularity of the sf package, and the need for spbabel is fading. If you are looking at spbabel to decompose spatial, I recommend looking at sfheaders and/or silicate. In combination these packages provide most workflows required to move to and from the sf format, without the sf package.</em></p>
<p>If you need help please <a href="https://github.com/hypertidy/silicate/" class="external-link">get in touch</a>.</p>
<div class="section level1">
<div class="page-header"><h1 id="spbabel-for-spatial-forms">spbabel for spatial forms<a class="anchor" aria-label="anchor" href="#spbabel-for-spatial-forms"></a>
</h1></div>
<p>The spbabel provides simple tools to flip between specialist, bespoke formats and tabular, generic forms of spatial data. This package aims assist in the ongoing development of tools for spatial data in R. This is really a set of tools for developing other tools, but do see some examples in the vignettes.</p>
<p>The key functions for simple decomposition and recomposition are <code>sptable</code> and <code>sp</code>, which provide the identified coordinates in a single data frame.</p>
<p>A more useful and extensible decomposition is provided by <code>map_table</code> which provides data frames of the object data, the parts data and the coordinates data as separate tables linked by ID. See here for more on the rationale. <a href="http://rpubs.com/cyclemumner/sc-rationale" class="external-link uri">http://rpubs.com/cyclemumner/sc-rationale</a> This table-based framework allows for the easy transfer between the different spatial representations in R, in generic database-ready tables.</p>
<p>Currently supported:</p>
<ul>
<li>sf</li>
<li>sp</li>
<li>silicate</li>
<li>trip</li>
<li>(some) rgl</li>
</ul>
<p>In progress:</p>
<ul>
<li>everything else</li>
<li>especially the other trajectory / animal tracking packages</li>
</ul>
<p>The tracking packages such as adehabitatLT, trajectories, and dozens of others <code>crawl</code> and <code>move</code> packages contain objects that could be coerced in a straightforward way, see the Spatio Temporal Task View for more (in the Moving Objects / Trajectories section). The hyperframe in spatstat is another example, and to follow up Edzer’s work in spacetime.</p>
<p>If you know of other variants that should be included, please file an issue or let me know. Once the basic framework is available, adding new conversions will be pretty simple.</p>
<p>There already are converters for Spatial classes, so why do this? There are converters, but the <code>sp</code> and <code>sf</code> classes adhere to a common denominator in modern GIS standards which is quite restrictive. There are many spatial data structures in R that cannot be represented, and that cannot be represented by extending the standard packages. Most other spatial software also goes around the simple features standards, and so we enter regions where we have no standards at all.</p>
<p>Conversions between existing forms is simply a side-benefit of having a more general framework. The main motivation is to be able to convert these commonly used types into forms ready for modern tools for interactive use, and to allow database back-ending without proliferation of complicated workarounds doing constant translation.</p>
<p>Not all pairwise combinations are of interest, but most importantly some of the representations are more general than others. The only one that can be used to represent all others is a set of relational tables, and ‘gris’ does most of this, but ‘ggplot2’ also comes pretty close. Neither have been used extensively to do this though!</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the package from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spbabel"</span><span class="op">)</span></span></code></pre></div>
<p>The development version can be installed directly from github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mdsumner/spbabel"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="formal-and-informal-spatial-data-in-r">Formal and informal spatial data in R<a class="anchor" aria-label="anchor" href="#formal-and-informal-spatial-data-in-r"></a>
</h2>
<p>Spatial data in the <code>sp</code> package have a formal definition (extending class <code>Spatial</code>) that is modelled on shapefiles, and close at least in spirit to the <a href="https://github.com/r-spatial/sf" class="external-link">Simple Features definition</a>.</p>
<p>Spatial data in the <code>ggplot2</code> package has no formal definition and there’s not a lot of guidance for how to switch between these two worlds, or the opportunities that exist for other options.</p>
<p>The <code>spbabel</code> package tries to help by providing a more systematic encoding into the long-form with consistent naming and lossless ways to re-compose the original (or somewhat modified) objects.</p>
<p>The long-form version is similar to that implemented in:</p>
<ul>
<li>sp’s <code>as()</code> coercion for <code>SpatialLinesDataFrame</code> to <code>SpatialPointsDataFrame</code>
</li>
<li>rasters’s <code>geom()</code>
</li>
<li>ggplot2’s <code>fortify()</code>
</li>
<li>silicate’s normalized tables</li>
</ul>
<p>NOTE: the <a href="https://CRAN.r-project.org/package=sfheaders" class="external-link">sfheaders package</a> provides the most powerful constructors for sf format, and provides a round-trip-able long form for sf that is a better standard than spbable ever provided.</p>
</div>
</div>
<div class="section level1">
<h1 id="how-does-spbabel-work">How does spbabel work<a class="anchor" aria-label="anchor" href="#how-does-spbabel-work"></a>
</h1>
<p>The <code>sptable</code> function decomposes a Spatial object to a single table structured as a row for every coordinate in all the sub-geometries, including duplicated coordinates that close polygonal rings, close lines and shared vertices between objects.</p>
<p>The <code>sp</code> function re-composes a Spatial object from a table, it auto-detects the topology by the matching column names:</p>
<ul>
<li>SpatialPolygons: object_, branch_, island_, order_</li>
<li>SpatialLines: object_, branch_, order_</li>
<li>SpatialPoints: object_</li>
<li>SpatialMultiPoints: object_, branch_</li>
</ul>
<p>After quite a lot of experimentation the long-form single table of all coordinates, with object, branch, island-status, and order provides the best middle-ground for transferring between different representations of Spatial data. Tables are always based on the “tibble” since it’s a much better data frame.</p>
<p>The <code>sptable</code> function creates the table of coordinates with identifiers for object and branch, which is understood by <code>sptable&lt;-</code> to “fortify” and <code>sp</code> for the reverse.</p>
<p>The long-form table may seem like soup, but it’s not meant to be seen for normal use. It’s very easy to dump this to databases, or to ask spatial databases for this form. There are other more normalized multi-table approaches as well - this is just a powerful lowest common denominator.</p>
<p>We can tidy this up by encoding the geometry data into a geometry-column, into nested data frames, or by normalizing to tables that store only one kind of data, or with recursive data structures such as lists of matrices. Each of these has strengths and weaknesses. Ultimately I want this to evolve into a fully-fledged set of tools for representing spatial/topological data in R, but still by leveraging existing code whereever possible.</p>
</div>
<div class="section level1">
<h1 id="why-do-this">Why do this?<a class="anchor" aria-label="anchor" href="#why-do-this"></a>
</h1>
<p>I want these things, and spbabel is the right compromise for where to start:</p>
<ul>
<li>flexibility in the number and type/s of attribute stored as “coordinates”, x, y, lon, lat, z, time, temperature, etc.</li>
<li>ability to store attributes on parts (!) i.e. the state is the object, the county is the part</li>
<li>shared vertices</li>
<li>ability to store points, lines and areas together, sharing topology where appropriate</li>
<li>provide a flexible basis for conversion between other formats.</li>
<li>flexibility and ease of use</li>
<li>integration with database engines and other systems</li>
<li>integration with D3 via htmlwidgets, with shiny, and with gggeom ggvis or similar</li>
<li>data-flow with dplyr piping as the engine behind a D3 web interface</li>
</ul>
<p>Flexibility in attributes generally is the key to breaking out of traditional GIS constraints that don’t allow clear continuous / discrete distinctions, or time-varying objects/events, 3D/4D geometry, or clarity on topology versus geometry. When everything is tables this becomes natural, and we can build structures like link-relations between tables that transfer data only when required.</p>
<p>The ability to use <a href="https://manifold.net/" class="external-link">Manifold System</a> seamlessly with R is a particular long-term goal, and this will be best done(TM) via dplyr “back-ending”.</p>
<p>A more general approach to this is started here: <a href="https://github.com/hypertidy/silicate/" class="external-link uri">https://github.com/hypertidy/silicate/</a></p>
<p>The decomposition and rebuild process of sf objects is now better thought out here: <a href="https://github.com/mdsumner/gibble" class="external-link uri">https://github.com/mdsumner/gibble</a> and is core to the operation of silicate.</p>
<hr>
<p>Please note that this project is released with a <a href="https://github.com/mdsumner/spbabel/blob/master/CONDUCT.md" class="external-link">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=spbabel" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mdsumner/spbabel/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mdsumner/spbabel/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing spbabel</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael D. Sumner <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
