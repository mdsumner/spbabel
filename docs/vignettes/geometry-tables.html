<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Michael D. Sumner" />

<meta name="date" content="2016-09-21" />

<title>Geometry in tables</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Geometry in tables</h1>
<h4 class="author"><em>Michael D. Sumner</em></h4>
<h4 class="date"><em>2016-09-21</em></h4>



<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p>This package is a response to the missing use-cases in GIS (geographic information systems) using R. It’s an attempt to provide a unified framework for doing the things that GIS traditionally cannot do without awkward workarounds.</p>
<p>Gris is not a replacement for the <em>very powerful</em> existing tools for traditional GIS is R. If there’s a better tool for the job, the ‘gris’ philosophy is to convert to the structures needed by that tool and do it, then return the result to gris world.</p>
<p>Gris provides</p>
<ul>
<li>a general, tidy, table-based framework for storing spatial data</li>
<li>a clear delineation between the <em>topology</em> and the <em>geometry</em> of spatial data, a distinction that is usually muddled</li>
<li>a unified and general data model that can be used to store any spatial data, and<br />
</li>
<li>a common framework for conversions from and to other formats</li>
</ul>
<p>Gris can be used to</p>
<ul>
<li>convert a flat vector drawing of polygons into a topological mesh of 2D triangles and 1D line segments with X, Y, Z geometry, while maintaining the identity of the original polygons and its discrete attributes.</li>
<li>to store and transmit complex spatial data via generic storage of tables in databases</li>
<li>store multi-dimensional geo-spatial data, such as 3d box models with “face” topology, or trajectory data with x, y, z, and time positions for the continuous movement along with continuous or discrete measurements made along the path.</li>
</ul>
<p>Gris relies on</p>
<ul>
<li>dplyr and tibble for sensible and powerful data frames</li>
<li>spbabel for conversion drivers from and to other formats</li>
</ul>
<p>Gris does not</p>
</div>
<div id="use-nested-tables-though-see" class="section level2">
<h2>-use nested tables, though see …</h2>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <code>sp</code> and <code>ggplot2</code> packages are both widely used in R for plotting maps. The visualization tools in <code>ggplot2</code> are very general and can be used for plotting a very wide variety of data visualizations as well as maps, but the data structures used are not aligned with how map data are usually stored. The tools and data structure tools for <code>sp</code> are very powerful and can be used for a wide variety of map-data manipulations and visualizations, but they are not inherently extensible.</p>
<p>This document aims to show that there are opportunities to bridge these seemingly disparate domains, and bring the general, data frame table-based idioms of <code>ggplot2</code> into the specialized domain of spatial data.</p>
</div>
<div id="two-worlds-and-two-tables" class="section level2">
<h2>Two worlds and two tables</h2>
<p>A <code>Spatial</code> object is a complex S4 classed structure composed of lists of coordinates, values, and metadata. It has</p>
<ul>
<li>a data frame of attributes for each individual map object</li>
<li>a complex hierarchical list of matrices of coordinates (x and y, or longitude and latitude)</li>
<li>projection metadata</li>
<li>a bounding box</li>
</ul>
<p>The geometry is in the complex list, and this is defined <em>just-so</em> by S4 classes with rigourous constraints to conform to spatial standards. This includes determined details such as the “winding” order for rings defining polygon islands or holes, and the details of which hole belongs to which island.</p>
<p>A <code>ggplot2</code> ‘object’ is a data frame, and—ok—it’s not really an object. It has columns:</p>
<ul>
<li>“long” and “lat” to store the ‘x’ and ‘y’ coordinates (or longitude and latitude)</li>
<li>“id” to identify each map object</li>
<li>“group” to identify each “piece” (polygon ring, line-path, or [multi-]point), unique across all objects</li>
<li>“piece” to identify each “piece” within “id” (unique only within ID, provides a count of pieces)</li>
<li>“order” to record the correct winding order, or path order</li>
<li>“hole” to denote if a polygon ring was a hole or an island</li>
</ul>
<p>There’s one major thing missing still, the <code>ggplot2</code> case is really two data frames, and the list neglects the exact same data frame that we listed first for ‘sp’. This table is rarely mentioned explicitly, since in all ggplot2 examples it only gets used in a merge step, to copy its attribute metadata on id to all the coordinates.</p>
<p>The other parts missing from ggplot2 is the details about which hole belongs to which island, the projection metadata, and the bounding box. T (I’m only talking about sp Spatial classes here, but the same scheme is used by gg tools for the maps package, and c. …).</p>
<p>What else is missing?</p>
<ul>
<li>identifiers on parts, ggplot understands this and maps provides it (with limitations)</li>
<li>identifiers on coordinates</li>
<li>topology</li>
</ul>
</div>
<div id="specific-example" class="section level2">
<h2>Specific example</h2>
<p>To illustrate the relation between <code>sp</code> and <code>ggplot2</code>, read in a polygon layer from the <code>maps</code> package and convert, and plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maps)
## there's a long side-story here, that we ignore for now
amap &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;world&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">resolution =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)
<span class="kw">map</span>(amap, <span class="dt">fill =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(amap)</code></pre></div>
<pre><code>## List of 4
##  $ x    : num [1:100964] -69.9 -69.9 -69.9 -70 -70.1 ...
##  $ y    : num [1:100964] 12.5 12.4 12.4 12.5 12.5 ...
##  $ range: num [1:4] -180 190.3 -85.2 83.6
##  $ names: chr [1:1627] &quot;Aruba&quot; &quot;Afghanistan&quot; &quot;Angola&quot; &quot;Angola:Cabinda&quot; ...
##  - attr(*, &quot;class&quot;)= chr &quot;map&quot;</code></pre>
<p>This is a simple list structure, with ‘x’ and ‘y’ values separate by ‘NA’, and a ‘names’ vector.</p>
<p>There is a name element for every “NA-separated” section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(amap$x))</code></pre></div>
<pre><code>## [1] 1626</code></pre>
<p>To plot this with gpplot2 we need a single table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fortify.map &lt;-<span class="st"> </span>function(x) {
  bad &lt;-<span class="st"> </span><span class="kw">is.na</span>(x$x)
  seq_ids &lt;-<span class="st"> </span><span class="kw">cumsum</span>(bad) +<span class="st"> </span>1L
  <span class="kw">data.frame</span>(<span class="dt">x =</span> x$x, <span class="dt">y =</span> x$y, <span class="dt">group =</span> seq_ids, <span class="dt">id =</span> seq_ids)[!bad, ]
}
<span class="kw">library</span>(ggplot2)
amaptab &lt;-<span class="st"> </span><span class="kw">fortify</span>(amap) 

<span class="kw">ggplot</span>(amaptab) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> group, <span class="dt">fill =</span> group) +<span class="st"> </span><span class="kw">geom_polygon</span>()</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div id="problem-1" class="section level3">
<h3>Problem 1</h3>
<p>If you look carefully there are two big problems, there’s an awkward polygon catastrophe a the “southern boundary” of Antarctica - it becomes clearer if we zoom in.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## for now, it's easier to subset by re-reading
ant &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;world&quot;</span>, <span class="dt">regions =</span> <span class="st">&quot;Antarctica&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)
<span class="kw">ggplot</span>(<span class="kw">fortify</span>(ant)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> group, <span class="dt">fill =</span> group) +<span class="st"> </span><span class="kw">geom_polygon</span>() +<span class="st"> </span><span class="kw">geom_path</span>()</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The problem is that in this coordinate system, there’s no extension of the continent to the “south pole”, and so the polygon wraps around awkwardly, leaving a dangle in the west. The issue is more apparent by including the boundary, with ‘geom_path’.</p>
<p>There’s no “fixing” this without putting on the dummy coordinates at [-180, -90] and [180, -90] - but we are stuck since when we do that we then get the funny boundary dangle when plotted in a reasonable projection.</p>
<p>Here’s a plot <em>without</em> the extra coordinates at the poles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggalt)</code></pre></div>
<pre><code>## ggalt is under *active* development. See https://github.com/hrbrmstr/ggalt for changes</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prj &lt;-<span class="st"> &quot;+proj=laea +lat_0=-90 +ellps=WGS84 +lon_0=140&quot;</span>
<span class="kw">ggplot</span>(<span class="kw">fortify</span>(ant)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> group, <span class="dt">fill =</span> group) +<span class="st"> </span><span class="kw">geom_polygon</span>() +<span class="st"> </span><span class="kw">geom_path</span>() +<span class="st"> </span><span class="kw">coord_proj</span>(prj)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Here’s one where the extra coordinates are present.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maptools)
<span class="kw">data</span>(wrld_simpl)
ant2 &lt;-<span class="st"> </span><span class="kw">subset</span>(wrld_simpl, NAME ==<span class="st"> &quot;Antarctica&quot;</span>)
<span class="kw">rownames</span>(ant2) &lt;-<span class="st"> </span><span class="ot">NULL</span>
## note it's now called &quot;long&quot;/&quot;lat&quot; not &quot;x&quot;/&quot;y&quot;
<span class="kw">ggplot</span>(<span class="kw">fortify</span>(ant2)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> group) +<span class="st"> </span><span class="kw">geom_polygon</span>() +<span class="st"> </span><span class="kw">geom_path</span>() +<span class="st"> </span><span class="kw">coord_proj</span>(prj) +<span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## Regions defined for each Polygons</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="problem-2" class="section level3">
<h3>Problem 2</h3>
<p>The second problem is that we are not drawing holes correctly. To see this zoom in on southern Africa, where the country of Lesotho punches out a hole in South Africa.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## for now, it's easier to subset by re-reading
afr &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;world&quot;</span>, <span class="dt">regions =</span> <span class="kw">c</span>(<span class="st">&quot;South Africa&quot;</span>, <span class="st">&quot;Lesotho&quot;</span>), <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)
<span class="kw">ggplot</span>(<span class="kw">fortify</span>(afr)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> group, <span class="dt">fill =</span> group) +<span class="st"> </span><span class="kw">geom_polygon</span>() +<span class="st"> </span><span class="kw">geom_path</span>()</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>That looks ok, but see what happens when we take just South Africa.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## for now, it's easier to subset by re-reading
<span class="kw">library</span>(ggpolypath)
safr &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;world&quot;</span>, <span class="dt">regions =</span> <span class="st">&quot;South Africa&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)
<span class="kw">ggplot</span>(<span class="kw">fortify</span>(safr)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span>group, <span class="dt">col =</span> <span class="kw">factor</span>(group)) +<span class="st"> </span><span class="kw">geom_polypath</span>() +<span class="st"> </span><span class="kw">geom_path</span>() </code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The data for South Africa is literally stored with the hole it needs to be plotted on its own, as well as the same “island” needed for Lesotho.</p>
<p>We can get the hole with polypath, but this reminds us that we are double-storing a lot of coordinates - this is the same for any neighbouring polygons, all those shared boundaries and not “shared”, they are stored explicitly.</p>
<p>Finally, show that sp plots the hole just fine without any effort.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
sp_afr &lt;-<span class="st"> </span><span class="kw">fortify</span>(afr) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">x_ =</span> x, <span class="dt">y_ =</span> y, <span class="dt">object_ =</span> <span class="kw">unlist</span>(<span class="kw">lapply</span>(<span class="kw">strsplit</span>(afr$names[id], <span class="st">&quot;:&quot;</span>), <span class="st">&quot;[&quot;</span>, 1L)), <span class="dt">branch_ =</span> id, 
         <span class="dt">island_ =</span> !<span class="kw">grepl</span>(<span class="st">&quot;hole&quot;</span>, afr$names[id]), <span class="dt">order_ =</span> <span class="kw">row_number</span>()) %&gt;%<span class="st"> </span>
<span class="st">  </span>spbabel::<span class="kw">sp</span>()

<span class="kw">plot</span>(sp_afr, <span class="dt">col =</span> <span class="kw">rainbow</span>(<span class="kw">nrow</span>(sp_afr)))</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAADFBMVEUAAAAA////AAD///9l7vaeAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADuUlEQVR4nO3b0VbaQBRA0VD//59bUUuowAm2nQmyz5tPc9lrnEACy4tutsweYO8BigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQ9FtCEaR8IaFmWw/LWyFUHrvVXvfJ8BOhTKx1AFzr3GSr0EEB/+gA66xMPoPM++xwGXsf2D3TBZ+QWelSgYXPvHuiiz8AttA+ga1MsFw7o5wS6MsY1nucDWr/glRag99ZAy+kIvu7zfECnV7wcL1K/jG4cQE93FVsBLSeF67tn4B2PvQFd3TUrn6Ez7wyoecbe7NgP0HFbXD91AL3dTN3A8w407MbrboDuaHk5v+7939GGrFLdB3R422yANmykAaMNWaX6CtCgyacBnZ2xgC4svBb6AtCowScBnR2ym67vs578zAI6HH4/Rt6ks/w4E/r+n8VWz5G3+Px47UT0DE817jl23nx+CX38PXLOgWudL7yd57fPMt5n4vugzULLzA30CECHjxPoYwMBurCFTm8FBk888aPGXUJzvj318iBA6/cCowee+WH1S5/AAN32GT/k8BXXi+9+/8y+H3TvncQZI05Yc7X67n1m31G860o2Z8Ipq56Wv8PnCYG2PgmbxzMdaN//XscZp638cgfQtP0z+wzaJjSRZzZQHtLHH0DNnXDq6je30PErH5N5dgB0/jundfNxXpsP9E40+peEW9vBTMvsc/hmexhsn1vnvR2Pto8ARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYq+GdC//+3iNwP69wGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoOgnBKa6mSF/p5cAAAAASUVORK5CYII=" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(sp_afr[<span class="dv">2</span>, ], <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAACVBMVEUAAAC+vr7////xRzILAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADvklEQVR4nO3b7VLaQBiA0eD9X3Rb/CAo8ATb7gY5zz+dcfb1zLohQZYX3WyZPcDeAxQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoAhQBigBFgCJAEaAIUAQoeiygCdM+ENCyLIfltZGrDlzrr/rD8x6gL610AF3o3Geo0EMAffYBdNYXHkDnffU5DLyO7R/ogs/ILfSoQMPm3j3QRZ+BW2gfQNemWC4c0M8JdGWMazzPB7T+hVdagN5aAy2nI/i6z/MBnX7j5XiR+m104wB6uqvYCmg5KVzfPQOfeOwN6OquWfkMnXlnQM0z9mHHfoCO2+L6qQPo9WHqBp43oGEPXncDdEfLy/l17/+ONmSV6j6gw+tmA7RhIw0Ybcgq1XeABk0+DejsjAV0YeG10DeARg0+CejskN10fZ/1zs8soMPh423kTTrL+U3Iz78XW72PvMXn9WeWT98YMuiwlT4v3C5f/pyWT18PmXPgWucLb+f58FnG+0x8HbRZaJm5gR4B6P1JyMcGAnRhC51eCgyeeOKtxl1Cc/576uVBgNavBUYPPPNm9Vt3YIBu+4wfcviK68V3v39mPw+690nijBEnrLlaffc+s58ofueObPCEU1Y9LX+HzxMCbX0nbB7PdKB9/3kdZ5y28ssdQNP2z+wzaJvQRJ7ZQHlIHz8ANXfCqavf3ELHf/mYzLMDoPPPOa2bj/On+UBvRKM/Sbi1Hcy0zD6Hb7aHwfa5dd7a8Wj7CFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGgCFAEKAIUAYoARYAiQBGg6IcB/fvPLv4woH8foAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKAEWAIkARoAhQBCgCFAGKfgHbIX7ZOMvyOQAAAABJRU5ErkJggg==" /><!-- --></p>
</div>
</div>
<div id="spbabel" class="section level2">
<h2>spbabel</h2>
<p>There are theree functions in <code>spbabel</code> to transfer between ‘sp’ and ‘ggplot2’.</p>
<ol style="list-style-type: decimal">
<li>**sptable* - decomposes the geometry to a single table (like <code>fortify</code> but with different column names)</li>
<li><strong>sp</strong> - a driver function to produce Spatial objects, in this case a ‘sp.data.frame’ method</li>
<li><strong>sptable&lt;-</strong> - a replacement version of ‘sptable’ to do the changes “in place”</li>
</ol>
<p>In simplest form, the journey goes like this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spbabel)
wrld_geom &lt;-<span class="st"> </span><span class="kw">sptable</span>(wrld_simpl)
wrld_data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(wrld_simpl) ## make clear that we need two tables

(sp_rtrip &lt;-<span class="st"> </span><span class="kw">sp</span>(wrld_geom, <span class="dt">attr_tab =</span> wrld_data))</code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 246 
## extent      : -180, 180, -90, 83.57027  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## variables   : 11
## # A tibble: 246 × 11
##      FIPS   ISO2   ISO3    UN                NAME   AREA  POP2005
##    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt;              &lt;fctr&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1      AC     AG    ATG    28 Antigua and Barbuda     44    83039
## 2      AG     DZ    DZA    12             Algeria 238174 32854159
## 3      AJ     AZ    AZE    31          Azerbaijan   8260  8352021
## 4      AL     AL    ALB     8             Albania   2740  3153731
## 5      AM     AM    ARM    51             Armenia   2820  3017661
## 6      AO     AO    AGO    24              Angola 124670 16095214
## 7      AQ     AS    ASM    16      American Samoa     20    64051
## 8      AR     AR    ARG    32           Argentina 273669 38747148
## 9      AS     AU    AUS    36           Australia 768230 20310208
## 10     BA     BH    BHR    48             Bahrain     71   724788
## # ... with 236 more rows, and 4 more variables: REGION &lt;int&gt;,
## #   SUBREGION &lt;int&gt;, LON &lt;dbl&gt;, LAT &lt;dbl&gt;</code></pre>
<p>The table ‘wrld_geom’ carried its map projection string with it as an ‘attribute’, but this is not reliable without creating methods for a special class. We can make sure it’s carried using a manual step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrld_geom &lt;-<span class="st"> </span><span class="kw">sptable</span>(wrld_simpl)
wrld_data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(wrld_simpl) ## make clear that we need two tables
wrld_prj &lt;-<span class="st"> </span><span class="kw">proj4string</span>(wrld_simpl)
(sp_rtrip &lt;-<span class="st"> </span><span class="kw">sp</span>(wrld_geom, <span class="dt">attr_tab =</span> wrld_data, <span class="dt">crs =</span> wrld_prj))</code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 246 
## extent      : -180, 180, -90, 83.57027  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
## variables   : 11
## # A tibble: 246 × 11
##      FIPS   ISO2   ISO3    UN                NAME   AREA  POP2005
##    &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;int&gt;              &lt;fctr&gt;  &lt;int&gt;    &lt;dbl&gt;
## 1      AC     AG    ATG    28 Antigua and Barbuda     44    83039
## 2      AG     DZ    DZA    12             Algeria 238174 32854159
## 3      AJ     AZ    AZE    31          Azerbaijan   8260  8352021
## 4      AL     AL    ALB     8             Albania   2740  3153731
## 5      AM     AM    ARM    51             Armenia   2820  3017661
## 6      AO     AO    AGO    24              Angola 124670 16095214
## 7      AQ     AS    ASM    16      American Samoa     20    64051
## 8      AR     AR    ARG    32           Argentina 273669 38747148
## 9      AS     AU    AUS    36           Australia 768230 20310208
## 10     BA     BH    BHR    48             Bahrain     71   724788
## # ... with 236 more rows, and 4 more variables: REGION &lt;int&gt;,
## #   SUBREGION &lt;int&gt;, LON &lt;dbl&gt;, LAT &lt;dbl&gt;</code></pre>
<p>What is the point of doing this? We can modify the data using standard table tools.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrld_geom &lt;-<span class="st"> </span><span class="kw">sptable</span>(wrld_simpl[<span class="dv">9</span>, ])
wrld_prj &lt;-<span class="st"> </span><span class="kw">proj4string</span>(wrld_simpl)
<span class="kw">sp</span>(wrld_geom, <span class="dt">crs =</span> wrld_prj)</code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1 
## extent      : 112.9511, 159.1019, -54.74973, -10.05167  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
## variables   : 1
## # A tibble: 1 × 1
##   rownumber_
##        &lt;int&gt;
## 1          1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrld_geom$object_ &lt;-<span class="st"> </span>wrld_geom$branch_
<span class="kw">sp</span>(wrld_geom, <span class="dt">crs =</span> wrld_prj)</code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 97 
## extent      : 112.9511, 159.1019, -54.74973, -10.05167  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0 
## variables   : 1
## # A tibble: 97 × 1
##    rownumber_
##         &lt;int&gt;
## 1           1
## 2           2
## 3           3
## 4           4
## 5           5
## 6           6
## 7           7
## 8           8
## 9           9
## 10         10
## # ... with 87 more rows</code></pre>
<p>See how we decomposed all the parts into their own object, and once we return to <code>Spatial</code> that is reflected in the number of objects.</p>
<p>The replacement method allows this to be done without breaking anything apart, so this is the more “user-level” function, where ‘sp’ and ‘sptable’ are for developers. With this version we can very easily pipe our geometry modifications in convenient syntax.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wrld &lt;-<span class="st"> </span>wrld_simpl[<span class="dv">9</span>:<span class="dv">10</span>, ] ## pick two objects this time
<span class="kw">sptable</span>(wrld) &lt;-<span class="st"> </span><span class="kw">sptable</span>(wrld) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">object_ =</span> branch_)
wrld</code></pre></div>
<p>There is a gotcha here in that if we had any “holes” they would now be “non-hole” objects, but with that caveat in mind it’s a powerful way to work with these data.</p>
<p>Note that the attribute data were dropped as it is now ambiguous as to what values corresponde to which objects, and that information is external to the replacement methods. (The ‘sp::disaggregate’ function is really a better way to do that particular task.)</p>
<p>This is not done with a single object with a special class, but it could be. See document on an S3 class for fortified, single-nested, and double-nested forms.</p>
<p>Perhaps the best thing about having everything stored in two tables is that we can push it out to a database, pass that to someone else and everything is transferred correctly.</p>
<p>Let’s send a fortified copy of the maps “county” data set to someone in a ‘SQLite’ database.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tibble)
<span class="kw">library</span>(maps)
<span class="kw">library</span>(ggplot2)
db &lt;-<span class="st"> </span><span class="kw">src_sqlite</span>(<span class="st">&quot;data-raw/maps_county.sqlite3&quot;</span>, <span class="dt">create =</span> <span class="ot">TRUE</span>)
mp &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)
## todo make sure the object ids are right 
## and that these are sp()-able - add interpreters for the fortify form (?)
geom &lt;-<span class="st"> </span><span class="kw">copy_to</span>(db, <span class="kw">fortify</span>(mp), <span class="dt">name =</span> <span class="st">&quot;geom&quot;</span>, <span class="dt">temporary =</span> <span class="ot">FALSE</span>)
## I can be a bit old-fashioned
statename &lt;-<span class="st"> </span><span class="kw">substr</span>(mp$name, <span class="dv">1</span>, <span class="kw">unlist</span>(<span class="kw">gregexpr</span>(<span class="st">&quot;,&quot;</span>, mp$name)) -<span class="st"> </span>1L)
countyname &lt;-<span class="st"> </span><span class="kw">substr</span>(mp$name, <span class="kw">unlist</span>(<span class="kw">gregexpr</span>(<span class="st">&quot;,&quot;</span>, mp$name)) +<span class="st"> </span><span class="dv">1</span>, <span class="kw">nchar</span>(mp$name))
dat &lt;-<span class="st"> </span><span class="kw">copy_to</span>(db, <span class="kw">tibble</span>(<span class="dt">county =</span> countyname, 
                          <span class="dt">state =</span> statename, <span class="dt">group =</span> <span class="kw">seq_along</span>(statename)), <span class="dt">name =</span> <span class="st">&quot;metadata&quot;</span>, <span class="dt">temporary =</span> <span class="ot">FALSE</span>)
geom
dat
<span class="kw">rm</span>(geom, dat, db)</code></pre></div>
<p>Another document that receives this database and explores nesting, demand-read.</p>
</div>
<div id="tidy-tables" class="section level2">
<h2>Tidy tables</h2>
<p>We have tidied up in one sense, we’ve removed a complicated object with specialist requirements and created two tables that can be plotted and manipulated with generic tools.</p>
<p>There is redundancy in the geometry table. ‘Tidy’ means ‘3NF’ or ‘third-normal-form’, and 3NF means that we remove the repeated values that could be stored just once.</p>
<p>Notice what we actually have in the “fortified” version of an sp object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">allnumbers &lt;-<span class="st"> </span>function(x) {x[] &lt;-<span class="st"> </span><span class="kw">lapply</span>(x, function(a) if(<span class="kw">is.character</span>(a)) <span class="kw">as.integer</span>(<span class="kw">factor</span>(a)) else <span class="kw">as.numeric</span>(a)); x}

oz &lt;-<span class="st"> </span><span class="kw">subset</span>(wrld_simpl, NAME ==<span class="st"> &quot;Australia&quot;</span>)
<span class="kw">plot</span>(<span class="kw">allnumbers</span>(<span class="kw">fortify</span>(oz)), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> <span class="fl">0.2</span>)</code></pre></div>
<pre><code>## Regions defined for each Polygons</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Clearly there’s really not much information in the fortified table after you have dealt with the x and y coordinates, there’s a lot of wasted storage here.</p>
<p>‘Spatial’ classes avoid this wastage by not exploring the encoding explicitly on every coordinate, but in one of two ways, either</p>
<ul>
<li>implicitly, or</li>
<li>just once as a sort of “label” attribute</li>
</ul>
<p>The implicit examples are ‘order’, the right order for the coordinates is just the order they come in, the ‘piece’ value is either 1, or 2+ depending on a list of length 1 or more, and id and group are the same. Group and piece are really aliases, just one is absolute (to the entire set) the other relative (to position within a geometry) .</p>
<p>Tags such whether it is a hole or not is an “attribute” tagged onto the object that holds the matrix of coordinates. We don’t see the “comments” attribute here, which in sp (if present) tells us which piece ‘belongs’ to which other piece (i.e. when it’s a hole, what island is it a hole of?).</p>
<p>Again, this is discussed [elsewhere] but the crux is the need for comments is a legacy of the “shapefile” era, no longer necessary in this the “simple features” era. More on that later.</p>
<p>(There are subtle rules and conventions about ordering and holes, which is discussed [elsewhere]).</p>
<p>How do we remove this redundancy?</p>
<ul>
<li>Create complex nested objects (we already have sp, maps, and other examples).</li>
<li>Create “tidy(-ish)” tables using nesting, there are at least three ways to do this (gggeom, single, double nesting)</li>
<li>Create normalized tables and put like with like.</li>
</ul>
<p>TABLES</p>
<p>First identify the entities that exist.</p>
<p>Objects, parts, coordinates.</p>
<p>If we create a “parts” table, we will have three tables, one with all the x/y coordinates and their part ID and order within part, the parts table with attributes part ID, island status, and the object metadata table.</p>
<p>Benefit is size of data is reduced.</p>
</div>
<div id="four-tables" class="section level2">
<h2>Four tables</h2>
<p>Further normalization inserts a partXcoord table, and puts the order and vertex id on this. Benefit is</p>
<ul>
<li>further data reduction</li>
<li>removal of duplicated coordinates</li>
<li>ability to demand page</li>
<li>ready for topology</li>
</ul>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
