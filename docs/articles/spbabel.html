<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>spbabel • spbabel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="spbabel">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spbabel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/spbabel.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>spbabel</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2020-04-07</h4>
      
      
      <div class="hidden name"><code>spbabel.Rmd</code></div>

    </div>

    
    
<div id="spbabel-a-tidy-view-of-spatial" class="section level1">
<h1 class="hasAnchor">
<a href="#spbabel-a-tidy-view-of-spatial" class="anchor"></a>spbabel: a tidy view of Spatial</h1>
<p>Spbabel provides simple tools to flip between Spatial and tidy forms of data. This package aims to assist in the ongoing development of tools for spatial data in R.</p>
<p>NOTE: this is largely deprecated by new code in <a href="https://github.com/hypertidy/silicate" class="uri">https://github.com/hypertidy/silicate</a>.</p>
<div id="formal-spatial-data-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#formal-spatial-data-in-r" class="anchor"></a>Formal spatial data in R</h2>
<p>Spatial data in the <code>sp</code> package have a formal definition (extending class <code>Spatial</code>) that is modelled on shapefiles, and close at least in spirit to the <a href="https://github.com/edzer/sfr">Simple Features definition</a>. See <a href="https://github.com/mdsumner/spbabel/wiki/What-is-Spatial-in-R">What is Spatial in R?</a> for more details.</p>
<p>Turning these data into long-form tables has been likened to making fish soup, which has a nice nod to the universal translator <a href="https://en.wikipedia.org/wiki/The_Hitchhiker%27s_Guide_to_the_Galaxy">babelfish</a>.</p>
<p>The <code>spbabel</code> package tries to help by providing a more systematic encoding into the long-form with consistent naming and lossless ways to re-compose the original (or somewhat modified) objects.</p>
<p>There are two main forms.</p>
<ol style="list-style-type: decimal">
<li>The two-table form is the “coordinates with identifiers”, and the metadata</li>
<li>The four-table form applies <em>database normalization</em> of the coordinates table into branches and vertices, adding a fourth link table to allow de-duplication of the coordinates.</li>
</ol>
<p>The two-table version is similar to that implemented in:</p>
<ul>
<li>sp’s <code>as()</code> coercion for <code>SpatialLinesDataFrame</code> to <code>SpatialPointsDataFrame</code>
</li>
<li>rasters’s <code>geom()</code>
</li>
<li>ggplot2’s <code><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify()</a></code>
</li>
<li>gris’ normalized tables</li>
</ul>
<p>The four-table form is in development across a number of projects. It is straightforward to work with but there aren’t any high-level tools in package form yet. (Though <a href="http://australianantarcticdivision.github.io/rbgm/">rbgm</a> is probably the most advanced, it uses an early form that was absolutely necessary to read everything in those files before the more general approach here).</p>
</div>
</div>
<div id="how-do-the-sptable-and-sp-functions-work" class="section level1">
<h1 class="hasAnchor">
<a href="#how-do-the-sptable-and-sp-functions-work" class="anchor"></a>How do the ‘sptable()’ and ‘sp()’ functions work</h1>
<p>The long-form single table of all coordinates, with object, branch, island-status, and order provides a reasonable middle-ground for transferring between different representations of Spatial data. Tables are always based on the “tibble” since it’s a much better data frame.</p>
<p>The <code>sptable</code> function creates the table of coordinates with identifiers for object and branch, which is understood by <code>sptable&lt;-</code> to “fortify” and <code>sp</code> for the reverse.</p>
<p>The long-form table may seem like soup, but it’s not meant to be seen for normal use. It’s very easy to dump this to databases, or to ask spatial databases for this form. There are other more normalized multi-table approaches as well - this is just a powerful lowest common denominator.</p>
<p>We can tidy this up by encoding the geometry data into a geometry-column, into nested data frames, or by normalizing to tables that store only one kind of data, or with recursive data structures such as lists of matrices. Each of these has strengths and weaknesses. Ultimately I want this to evolve into a fully-fledged set of tools for representing spatial/topological data in R, but still by leveraging existing code whereever possible.</p>
</div>
<div id="sptable-a-round-trip-able-extension-to-fortify" class="section level1">
<h1 class="hasAnchor">
<a href="#sptable-a-round-trip-able-extension-to-fortify" class="anchor"></a>sptable: a round-trip-able extension to fortify</h1>
<p>The <code>sptable</code> function decomposes a Spatial object to a single table structured as a row for every coordinate in all the sub-geometries, including duplicated coordinates that close polygonal rings, close lines and shared vertices between objects.</p>
<p>The <code>sp</code> function re-composes a Spatial object from a table, it auto-detects the topology by the matching column names:</p>
<ul>
<li>SpatialPolygons: object_, branch_, island_, order_</li>
<li>SpatialLines: object_, branch_, order_</li>
<li>SpatialPoints: object_</li>
<li>SpatialMultiPoints: object_, branch_</li>
</ul>
<p>The <code>sp</code> function could include overrides to avoid these tests but it’s <em>so easy</em> to modify a table to have the matches for the required topology it hardly seems worth it.</p>
<p>Use the <code>sptable&lt;-</code> replacement method to modify the underlying geometric attributes (here <code>x</code> and <code>y</code> is assumed no matter what coordinate system).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(maptools)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(wrld_simpl)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(spbabel)</span>
<span id="cb1-4"><a href="#cb1-4"></a>(oz &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(wrld_simpl, NAME <span class="op">==</span><span class="st"> "Australia"</span>))</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1 
## extent      : 112.9511, 159.1019, -54.74973, -10.05167  (xmin, xmax, ymin, ymax)
## variables   : 11
## # A tibble: 1 x 11
##   FIPS  ISO2  ISO3     UN NAME        AREA  POP2005 REGION SUBREGION   LON   LAT
##   &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;fct&gt;      &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 AS    AU    AUS      36 Australia 768230 20310208      9        53  136. -25.0</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## long-form encoding of objects</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>oztab &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sptable.html">sptable</a></span>(oz)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">##  make a copy to modify</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>woz &lt;-<span class="st"> </span>oz</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">## modify the geometry on this object without separating the vertices from the objects</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw"><a href="../reference/sptable.html">sptable</a></span>(woz) &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sptable.html">sptable</a></span>(woz) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">x_ =</span> x_ <span class="op">-</span><span class="st"> </span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded datum WGS_1984 in CRS definition,
##  but +towgs84= values preserved</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># plot to compare </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(oz, <span class="dt">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(woz, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="spbabel_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>We can also restructure objects, by mutating the value of object to be the same as “branch” we get individual objects from each.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>pp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sptable.html">sptable</a></span>(wrld_simpl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(NAME <span class="op">==</span><span class="st"> "Japan"</span> <span class="op">|</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Korea"</span>, NAME)))</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">## explode (or "disaggregate"") objects to individual polygons</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">## here each branch becomes an object, and each object only has one branch</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">## (ignoring hole-vs-island status for now)</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>wone &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sp.html">sp</a></span>(pp <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">object_ =</span> branch_), <span class="dt">crs =</span> <span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(pp, <span class="st">"crs"</span>))</span>
<span id="cb6-6"><a href="#cb6-6"></a>op &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/sp.html">sp</a></span>(pp), <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="dt">length =</span> <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(pp<span class="op">$</span>object)))))</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: 'object'.</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(wone, <span class="dt">col =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(wone), <span class="dt">alpha =</span> <span class="fl">0.6</span>)), <span class="dt">border =</span> <span class="ot">NA</span>)</span></code></pre></div>
<p><img src="spbabel_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</span></code></pre></div>
<p>The long-form table is also ready for ggplot2:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(pp) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(object_), <span class="dt">group =</span> branch_) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span>()</span></code></pre></div>
<p><img src="spbabel_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">## resample the branch_ IDs to mix up the colours so that </span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">## object disaggregation is more apparent</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">10</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(pp) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(branch_)), <span class="dt">group =</span> branch_, <span class="dt">col =</span> object_) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span>()</span></code></pre></div>
<p><img src="spbabel_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>Please note that that <code>geom_polygon</code> cannot handle islands with multiple holes, and it only can do one hole by pretending it is a closed path and hides the boundary so you don’t see the sleight of hand. See the package ‘ggpolypath’ for a ‘geom_polypath’ geom.</p>
<div id="de-duplication-of-vertices" class="section level2">
<h2 class="hasAnchor">
<a href="#de-duplication-of-vertices" class="anchor"></a>De-duplication of vertices</h2>
<p>For the four-table for de-duplication is performed in “x”/“y” by default, but the technique is general and could be applied to a geometric space of any dimension. Duplicates are identified by coercing numeric values to character (after ‘base::duplicated’) and so is not robust to numeric issues. We haven’t found any problems yet.</p>
<p>An example of working with the four table form.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>codes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AUS"</span>,  <span class="st">"SLB"</span>,  <span class="st">"FJI"</span>, <span class="st">"FSM"</span>, <span class="st">"KIR"</span>, </span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">"NCL"</span>, <span class="st">"NFK"</span>, <span class="st">"CCK"</span>, <span class="st">"CXR"</span>, <span class="st">"VUT"</span>, <span class="st">"NRU"</span>,  <span class="st">"PNG"</span>, </span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">"SGP"</span>, <span class="st">"TUV"</span>, <span class="st">"IDN"</span>, <span class="st">"TLS"</span>, <span class="st">"PLW"</span>, <span class="st">"MHL"</span>, <span class="st">"NZL"</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a>mm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_table.html">map_table</a></span>(wrld_simpl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(ISO3 <span class="op">%in%</span><span class="st"> </span>codes))</span></code></pre></div>
<pre><code>## Warning: 'map_table' is deprecated.
## See help("Deprecated")</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">## cross the dateline properly</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>mm<span class="op">$</span>v &lt;-<span class="st"> </span>mm<span class="op">$</span>v <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">x_ =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(x_ <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, x_ <span class="op">+</span><span class="st"> </span><span class="dv">360</span>, x_))</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mm<span class="op">$</span>v[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x_"</span>, <span class="st">"y_"</span>)])</span></code></pre></div>
<p><img src="spbabel_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co">## get an sp object</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">## cascaded inner join and arrange within branch</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>ctable &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(mm, </span>
<span id="cb15-4"><a href="#cb15-4"></a>       <span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(v, bXv) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(b) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="st">         </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(branch_, order_) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="st">         </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>vertex_))</span></code></pre></div>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "branch_"</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>mm_sp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sp.html">sp</a></span>(ctable, </span>
<span id="cb18-2"><a href="#cb18-2"></a>            <span class="dt">attr_tab =</span> mm<span class="op">$</span>o)</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>mm_sp</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 19 
## extent      : 95.00803, 209.7808, -54.74973, 14.59805  (xmin, xmax, ymin, ymax)
## variables   : 12
## # A tibble: 19 x 12
##    FIPS  ISO2  ISO3     UN NAME    AREA POP2005 REGION SUBREGION   LON     LAT
##    &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;int&gt; &lt;fct&gt;  &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 AS    AU    AUS      36 Aust… 768230  2.03e7      9        53 136.  -25.0  
##  2 BP    SB    SLB      90 Solo…   2799  4.72e5      9        54 160.   -9.61 
##  3 FJ    FJ    FJI     242 Fiji    1827  8.28e5      9        54 178.  -17.8  
##  4 FM    FM    FSM     583 Micr…     70  1.10e5      9        57 158.    6.88 
##  5 KR    KI    KIR     296 Kiri…     73  9.20e4      9        57 175.   -1.51 
##  6 NC    NC    NCL     540 New …   1828  2.34e5      9        54 165.  -21.4  
##  7 NF    NF    NFK     574 Norf…      0  0.          9        53 168.  -29.0  
##  8 CK    CC    CCK     166 Coco…      1  0.          0         0  96.8 -12.2  
##  9 KT    CX    CXR     162 Chri…      0  0.          0         0 106.  -10.4  
## 10 NH    VU    VUT     548 Vanu…   1219  2.15e5      9        54 167.  -15.4  
## 11 NR    NR    NRU     520 Nauru      2  1.01e4      9        57 167.   -0.522
## 12 NZ    NZ    NZL     554 New …  26799  4.10e6      9        53 172.  -42.6  
## 13 PP    PG    PNG     598 Papu…  45286  6.07e6      9        54 143.   -5.95 
## 14 SN    SG    SGP     702 Sing…     67  4.33e6    142        35 104.    1.35 
## 15 TV    TV    TUV     798 Tuva…      3  1.04e4      9        61 179.   -8.51 
## 16 ID    ID    IDN     360 Indo… 181157  2.26e8    142        35 114.   -0.976
## 17 TT    TL    TLS     626 Timo…   1487  1.07e6    142        35 126.   -8.82 
## 18 PS    PW    PLW     585 Palau      0  2.01e4      9        57 135.    7.50 
## 19 RM    MH    MHL     584 Mars…      0  5.67e3      9        57 169.    7.60 
## # … with 1 more variable: object_1 &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mm_sp, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/gray.html">grey</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(mm_sp))))</span></code></pre></div>
<p><img src="spbabel_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co">## get a gg plot</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(ctable <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(mm<span class="op">$</span>o, NAME, object_))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">group =</span> branch_, <span class="dt">fill =</span> NAME) <span class="op">+</span><span class="st"> </span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span>() <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>()</span></code></pre></div>
<pre><code>## Joining, by = "object_"</code></pre>
<p><img src="spbabel_files/figure-html/unnamed-chunk-6-1.png" width="864"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#spbabel-a-tidy-view-of-spatial">spbabel: a tidy view of Spatial</a><ul class="nav nav-pills nav-stacked">
<li><a href="#formal-spatial-data-in-r">Formal spatial data in R</a></li>
      </ul>
</li>
      <li><a href="#how-do-the-sptable-and-sp-functions-work">How do the ‘sptable()’ and ‘sp()’ functions work</a></li>
      <li>
<a href="#sptable-a-round-trip-able-extension-to-fortify">sptable: a round-trip-able extension to fortify</a><ul class="nav nav-pills nav-stacked">
<li><a href="#de-duplication-of-vertices">De-duplication of vertices</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
